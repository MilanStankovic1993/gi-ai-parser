Thought for 9s

MoÅ¾e, super mesto da se stane za danas ğŸ‘Œ
Evo detaljan â€œdaily reportâ€ Å¡ta smo sve napravili u projektu GI AI Parser â€“ Faza 1 (parser cenovnika).

1. Osnova projekta i okruÅ¾enje
1.1. Laravel projekat

Napravili smo potpuno nov Laravel projekat:

Naziv foldera: gi-ai-parser

PodeÅ¡en u Laragonu (virtual host http://gi-ai-parser.test)

Povezan na MySQL bazu (npr. gi_ai_parser)

Sredili smo standardne Laravel stvari:

APP_KEY generisan (php artisan key:generate)

Migracije odraÄ‘ene (php artisan migrate)

Aplikacija radi lokalno kroz Laragon (Apache/Nginx + PHP)

1.2. Git / GitHub

Napravili smo git repozitorijum:

git init u C:\laragon\www\gi-ai-parser

dodali remote:

origin https://github.com/MilanStankovic1993/gi-ai-parser.git

Prvi commit:

â€œInitial Laravel setup for GI AI parserâ€

Push na main granu, repo je povezan sa GitHub-om

2. Filament admin panel
2.1. Instalacija Livewire + Filament

composer require livewire/livewire

composer require filament/filament:"^3.2"

php artisan filament:install

2.2. Admin panel provider

Kreirali smo Filament panel:

class AdminPanelProvider extends PanelProvider
{
    public function panel(Panel $panel): Panel
    {
        return $panel
            ->default()
            ->id('admin')
            ->path('admin')
            ->login()
            ->colors([
                'primary' => Color::Amber,
            ])
            ->discoverResources(in: app_path('Filament/Resources'), for: 'App\\Filament\\Resources')
            ->discoverPages(in: app_path('Filament/Pages'), for: 'App\\Filament\\Pages')
            ->pages([
                Pages\Dashboard::class,
            ])
            ->discoverWidgets(in: app_path('Filament/Widgets'), for: 'App\\Filament\\Widgets')
            ->widgets([
                Widgets\AccountWidget::class,
                Widgets\FilamentInfoWidget::class,
            ])
            ->middleware([...])
            ->authMiddleware([
                Authenticate::class,
            ]);
    }
}


Panel je dostupan na: /admin

Login radi, standardni Filament dashboard.

3. Modeli i baze: struktura Faze 1
3.1. price_lists (glavna tabela cenovnika)

Model: App\Models\PriceList
Polja (konceptualno):

id

original_filename â€“ ime fajla (npr. cenovnik_2026_vila_x.xlsx)

original_path â€“ putanja do fajla na disku (npr. price-lists/abc123.xlsx)

status â€“ npr. pending, processing, processed, needs_review, failed

processed_at â€“ kada je obrada zavrÅ¡ena

source â€“ npr. upload, email, api (za kasnije)

error_message ili sliÄno â€“ opis greÅ¡ke, ako padne obrada (u logovima joÅ¡ detaljnije)

Relacije:

public function rows()
{
    return $this->hasMany(PriceListRow::class);
}

public function logs()
{
    return $this->hasMany(PriceListLog::class);
}

3.2. price_list_rows (redovi standardizovane tabele)

Model: App\Models\PriceListRow

Ovo je â€œstandardizovanâ€ format koji klijent Å¾eli:

id

price_list_id â€“ veza na price_lists

sezona_od â€“ datum od (Y-m-d)

sezona_do â€“ datum do

tip_jedinice â€“ npr. 1/2 studio, 1/3 apartman

cena_noc â€“ cena po noÄ‡i

min_noci â€“ minimum noÄ‡enja

doplate â€“ dodatne doplate (klima, doruÄakâ€¦)

promo â€“ promo uslovi (npr. 7=6)

napomena â€“ dodatna napomena (kod Excela trenutno Äuvamo ceo originalni red kao JSON)

3.3. price_list_logs (logovi obrade)

Model: App\Models\PriceListLog

Polja:

id

price_list_id

step â€“ npr.:

uploaded

parsed

rows_inserted

validation_failed

finished

error

raw_input â€“ Å¡ta je uÅ¡lo u taj korak (po potrebi)

raw_output â€“ rezultat (JSON, tekst, poruka greÅ¡ke)

Ovo je jako bitno za klijenta: imaju â€œcrnu kutijuâ€ AI-ja razbijenu u Äitljive korake.

4. Filament resursi i admin UI

Napravili smo Filament resurse za rad sa ovim tabelama:

4.1. PriceListResource

Lista svih cenovnika:

kolone: id, original_filename, status, source, processed_at, created_at

moÅ¾eÅ¡ brzo da vidiÅ¡ Å¡ta je pending, Å¡ta je processed, Å¡ta ima problem

Create/Edit forma:

nije za krajnjeg korisnika (njihovi operateri Ä‡e uglavnom raditi upload, ne ruÄno unositi), ali postoji za debug/admin

4.2. PriceListRowResource

Lista svih redova:

moÅ¾eÅ¡ filtrirati po price_list_id i videti sve sezonske redove za konkretan cenovnik

vidiÅ¡: sezona_od, sezona_do, tip_jedinice, cena_noc, min_noci, promo, doplate, napomena

Korisno i za debug i za kasnije ruÄne korekcije.

4.3. PriceListLogResource

Pregled logova obrade:

kolone: price_list_id, step, created_at

u â€œViewâ€ vidiÅ¡:

raw_input

raw_output

npr. kod parsed vidiÅ¡ JSON niz redova, kod validation_failed vidiÅ¡ listu problema.

5. Upload cenovnika (Filament Page)

Napravili smo posebnu admin stranicu:

App\Filament\Pages\UploadPriceList
View: resources/views/filament/admin/pages/upload-price-list.blade.php

5.1. Forma (FileUpload)

U UploadPriceList Page:

public function form(Form $form): Form
{
    return $form
        ->schema([
            FileUpload::make('file')
                ->label('Cenovnik fajl')
                ->disk('public')
                ->directory('price-lists')
                ->required()
                ->acceptedFileTypes([
                    'application/pdf',
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'image/*',
                ])
                ->maxSize(10240),
        ])
        ->statePath('data');
}


Fajl ide na public disk u folder price-lists.

PodrÅ¾avamo: PDF, Excel, Word, slike (za sada Excel ide kroz pravi parser, ostalo ide na fake parser, ali je pipeline spreman).

5.2. Submit logika
public function submit(): void
{
    $path = $this->data['file'] ?? null;

    if (! $path) {
        Notification::make()
            ->title('Nije izabran fajl.')
            ->danger()
            ->send();

        return;
    }

    $priceList = PriceList::create([
        'original_filename' => basename($path),
        'original_path'     => $path,
        'status'            => 'pending',
        'source'            => 'upload',
    ]);

    // logujemo upload
    PriceListLog::create([
        'price_list_id' => $priceList->id,
        'step'          => 'uploaded',
        'raw_input'     => null,
        'raw_output'    => $path,
    ]);

    // pokreÄ‡emo job (kod tebe QUEUE_CONNECTION=sync, pa ide odmah)
    \App\Jobs\ProcessPriceList::dispatch($priceList->id);

    Notification::make()
        ->title('Cenovnik uspeÅ¡no otpremljen!')
        ->body('ID: '.$priceList->id)
        ->success()
        ->send();

    $this->reset('data');
    $this->form->fill();
}


Korisnik (operater) samo uploaduje fajl â†’ sistem automatski:

pravi zapis u price_lists

loguje korak uploaded

pokreÄ‡e ProcessPriceList job

6. Job: ProcessPriceList

Lokacija: App\Jobs\ProcessPriceList

6.1. Å ta radi job (visok nivo)

UÄita PriceList po ID-u

Setuje status: processing

Pozove PriceListParsingService da dobije niz standardizovanih redova

Pusti validator (PriceListValidator) da proveri sezonske datume

ObriÅ¡e stare redove, upiÅ¡e nove u price_list_rows

Upisuje logove:

parsed â€“ JSON svega Å¡to je dobio iz parsera

rows_inserted â€“ broj upisanih redova (ako si to ostavio)

validation_failed â€“ lista problema (ako ih ima)

finished â€“ kad sve proÄ‘e

Setuje status:

processed â€“ ako nema problema

needs_review â€“ ako validator naÄ‘e problem

failed â€“ ako pukne exception

6.2. Upis redova u bazu

KritiÄni deo:

$priceList->rows()->delete();

foreach ($rows as $row) {
    $priceList->rows()->create([
        'sezona_od'     => $row['sezona_od'] ?? null,
        'sezona_do'     => $row['sezona_do'] ?? null,
        'tip_jedinice'  => $row['tip_jedinice'] ?? null,
        'cena_noc'      => $row['cena_noc'] ?? null,
        'min_noci'      => $row['min_noci'] ?? null,
        'doplate'       => $row['doplate'] ?? null,
        'promo'         => $row['promo'] ?? null,
        'napomena'      => $row['napomena'] ?? null,
    ]);
}


Ide preko relacije $priceList->rows() â†’ sigurni smo da se koristi pravi model/tabela i da je price_list_id postavljen kako treba.

7. Servisi: parsiranje i validacija
7.1. PriceListParsingService

Lokacija: App\Services\PriceListParsingService

Ovo je â€œorkestratorâ€ za parsiranje:

gleda ekstenziju fajla

na osnovu toga bira parser

public function parse(PriceList $priceList): array
{
    $filename = $priceList->original_filename ?? '';
    $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));

    if (in_array($ext, ['xlsx', 'xls'])) {
        $parser = new ExcelPriceListParser();
    } else {
        $parser = new FakePriceListParser();
    }

    return $parser->parse($priceList);
}


Trenutno:

.xlsx / .xls â†’ pravi Excel parser

ostalo â†’ Fake parser (hardkodovani redovi, samo da pipeline radi dok ne ubacimo OCR+AI)

7.2. ExcelPriceListParser

Lokacija: App\Services\ExcelPriceListParser

Koristi OpenSpout v4 da Äita Excel fajl sa public diska.

Radi sa fajlom koji je uploadovan kroz Filament FileUpload.

Logika:

NaÄ‘e fajl na public disku (price-lists/...)

Otvori prvi sheet

Prvi ne-prazan red tretira kao header i preskaÄe

Svaki sledeÄ‡i red:

prve dve kolone su datumi (kao DateTime) â†’ konvertujemo u Y-m-d

treÄ‡a kolona: tip_jedinice

Äetvrta: cena_noc

peta: min_noci

Å¡esta: doplate

sedma: promo

ceo red Äuvamo u napomena kao JSON za debug

Rezultat:

[
    [
        'sezona_od'    => '2026-06-01',
        'sezona_do'    => '2026-06-30',
        'tip_jedinice' => '1/2 studio',
        'cena_noc'     => 35,
        'min_noci'     => 7,
        'doplate'      => 'klima +5',
        'promo'        => '',
        'napomena'     => '... JSON ceo red ...',
    ],
    ...
]


Funkcija normalizeDateCell() reÅ¡ava razliÄite formate (DateTime/String â†’ Y-m-d).

7.3. FakePriceListParser

Jednostavan parser koji vraÄ‡a hardkodovan niz sezona.

Koristi se za:

PDF

Word

slike itd. (dok ne ubacimo pravi OCR + AI)

Ovo nam omoguÄ‡ava da:

UI, logovi i validacija rade veÄ‡ sada

kad ubacimo pravi OCR/AI, samo promenimo parser za te ekstenzije.

7.4. PriceListValidator

Lokacija: App\Services\PriceListValidator

Ovo je srce validacije â€“ radi na veÄ‡ standardizovanom nizu redova.

Radi sledeÄ‡e:

Grupisanje redova po tip_jedinice (1/2 studio posebno, 1/3 posebnoâ€¦)

Sortira redove unutar grupe po datumu sezona_od

Prolazi red po red i traÅ¾i:

missing_dates â€“ ako sezona_od ili sezona_do fale

invalid_range â€“ sezona_od > sezona_do

overlap â€“ sezona poÄinje pre ili na dan kad prethodna zavrÅ¡ava

gap â€“ postoji rupa izmeÄ‘u sezona (nova sezona poÄinje kasnije od prethodni_do + 1 dan)

VraÄ‡a niz â€œissueâ€ objekata:

[
    [
        'type'    => 'overlap',
        'message' => 'Preklapanje sezona za tip "1/2 studio" izmeÄ‘u redova 0 i 1.',
        'rows'    => [0, 1],
    ],
    ...
]


U job-u:

ako $issues nije prazan â†’ status cenovnika = needs_review + log validation_failed

ako je prazan â†’ status = processed.

8. Queue / izvrÅ¡avanje job-a

Za sada smo postavili u .env:

QUEUE_CONNECTION=sync


To znaÄi:

ProcessPriceList se izvrÅ¡ava odmah, u istom requestu.

Nema potrebe da pokreÄ‡eÅ¡ php artisan queue:work dok razvijaÅ¡ lokalno.

Kasnije u produkciji:

moÅ¾eÅ¡ da prebaciÅ¡ na database ili neku drugu connection i da koristiÅ¡ pravi queue worker.

9. Å ta realno veÄ‡ moÅ¾eÅ¡ da pokaÅ¾eÅ¡ klijentu

VeÄ‡ sada imaÅ¡ MVP za Fazu 1 â€“ parser cenovnika:

Upload cenovnika kroz admin panel (jednostavno, jasno).

Sistem:

kreira zapis u bazi za cenovnik

Äuva fajl u storage/app/public/price-lists

pokreÄ‡e obradu

Parsiranje Excel cenovnika:

Äita redove iz Excela (tvoj primer Book1.xlsx)

pretvara ih u standardizovanu tabelu price_list_rows

Validacija:

proverava da li su sezonski datumi logiÄni (nema overlappinga, rupa, loÅ¡ih range-ova)

oznaÄi cenovnik kao processed ili needs_review

Logovi:

svaki korak je zabeleÅ¾en u price_list_logs

moÅ¾eÅ¡ da otvoriÅ¡ parsed log i kaÅ¾eÅ¡: â€œEvo kako AI/parsiranje vidi vaÅ¡ cenovnikâ€

moÅ¾eÅ¡ da otvoriÅ¡ validation_failed (kad napravimo primer sa greÅ¡kama) i pokaÅ¾eÅ¡ konkretne probleme

Drugim reÄima:
veÄ‡ sada imaÅ¡ radni skeleton Faze 1 sa realnim Excel fajlom, validatorom i admin UI-jem.

Ako hoÄ‡eÅ¡ sledeÄ‡i put, moÅ¾emo:

da doteramo joÅ¡ validacija (cena nelogiÄna, min_noci = 0 itd.)

da napravimo lepÅ¡i Filament dashboard za cenovnike (filter po statusu, samo problematiÄni)

ili da krenemo da â€œcrtamâ€ skeleton za:

PDF parser (tekstualni)

OCR parser (sken/slike)

AI parser (LLM â†’ JSON), ali da ostavimo stub dok ne odluÄimo koji taÄno model/servis.

Za danas si odradio baÅ¡ dobar chunk posla â€“ ovo veÄ‡ moÅ¾eÅ¡ da uvrstiÅ¡ u tehniÄku priÄu za klijenta kao prvi konkretan deo implementacije Faze 1.